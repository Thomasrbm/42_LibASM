# Configuration
NASM = nasm
CC = gcc
NASM_FLAGS = -f elf64 -g
OBJ_DIR = objects

# R√®gle magique pour n'importe quelle fonction (ex: make strlen)
%:
	@mkdir -p $(OBJ_DIR)
	
	@# Assemblage des fichiers source .s
	$(NASM) $(NASM_FLAGS) ft_$*.s -o $(OBJ_DIR)/ft_$*.o
	$(NASM) $(NASM_FLAGS) main_$*.s -o $(OBJ_DIR)/main_$*.o
	
	@# Linkage avec gcc (pour la libc) et d√©sactivation du PIE pour faciliter GDB
	$(CC) -no-pie $(OBJ_DIR)/main_$*.o $(OBJ_DIR)/ft_$*.o -o test_$*
	
	@echo "‚ú® Compilation finie pour $*"
	@echo "üìÅ Objets stock√©s dans : $(OBJ_DIR)/"
	@echo "üöÄ Ex√©cutable cr√©√© : ./test_$*"

all:
	@echo "Utilisation : make <nom_fonction> (ex: make strlen)"

# Supprime uniquement les fichiers objets et le dossier
clean:
	rm -rf $(OBJ_DIR)
	@echo "üßπ Dossier $(OBJ_DIR) supprim√©."

# Supprime les objets ET tous les ex√©cutables de test
fclean: clean
	rm -f test_*
	@echo "üóëÔ∏è  Tous les ex√©cutables 'test_*' ont √©t√© supprim√©s."

# Recommence tout √† z√©ro
re: fclean
	@echo "üîÑ Remise √† z√©ro effectu√©e."

.PHONY: clean fclean re